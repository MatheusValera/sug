extends ./layout/master
block head
  title Gerenciar obras
  link(rel="stylesheet", href="./styles/construction.css")
  script(src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js")
  script(src="https://unpkg.com/vanilla-masker@1.1.1/lib/vanilla-masker.js")

block content
  h1 Gerenciar obras
  button(onclick='openModal()' class="add") Adicionar
  main
    if constructions.length === 0
      p Não há obras cadastrados.
    else
      table
        thead
          tr
            th Id
            th Nome da obra
            th Data da criação
            th Data de atualização
            th ID da companhia
            th Nome da companhia
            th Status
        tbody
          each construction in constructions
            tr
              td= construction.id
              td= construction.name
              td= construction.createdAt.toLocaleString('pt-BR', { timezone: 'UTC' })
              td= construction.updatedAt ? construction.updatedAt.toLocaleString('pt-BR', { timezone: 'UTC' }): ''
              td= construction.companyId
              td= construction.company.name
              td= construction.status === 'active' ? 'Ativa' : 'Concluída'
              td
                button.editBtn(onclick=`openModal(${JSON.stringify(construction)})` data-id=construction.id ) Editar
                button.deleteBtn(onclick=`openModalDelete(${construction.id})` data-id=construction.id) Excluir

    #editModal.modal
      .modal-content
        span.closeModal &times;
        h2 Obra
        form(id="editUserForm")
          input(type="hidden", id="id", name="id")
          input(type="hidden", id="createdAt", name="createdAt")

          br
          label(for="nameConstruction") Nome da obra:
          input(type="text", id="nameConstruction", name="nameConstruction", required)

          br
          label(for="status") Status:
          select.select(id="statusSelect")
            option(value=0)
            option(value='active') Ativa
            option(value='finished') Concluída

          br
          label(for="contactResponsiblePerson") Companhia:
          select.select(id="companySelect")
            option(value=0)
            for company in companies
              option(value=company.id)= company.nameCompany

          br
          button(onclick='requestModal()') Salvar
          button(onclick='closeModal()') Cancelar
          label(id="errorMessage", style="display: none; color: red;")

    #deleteModal.modal
      .modal-content
        span.closeModal &times;
        h4 Confirmar Exclusão
        h4 Tem certeza de que deseja excluir essa companhia?
          input(type="text", id="idDelete", name="idDelete", readonly)

          br
          button.deleteBtn(onclick='deleteModalRequest()') Excluir
          button(onclick='closeModalDelete()') Cancelar
          label(id="errorMessageDelete", style="display: none; color: red;")

    script(src="./javascript/construction.js")