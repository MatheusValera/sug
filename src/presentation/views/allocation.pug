extends ./layout/master
block head
  title Gerenciar alocações
  link(rel="stylesheet", href="./styles/allocation.css")
  script(src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js")
  script(src="https://unpkg.com/vanilla-masker@1.1.1/lib/vanilla-masker.js")

block content
  h1 Gerenciar alocações
  button(onclick='openModal()' class="addUser") Criar alocação
  main
    if allocations.length === 0
      p Não há alocações cadastrados.
    else
      table
        thead
          tr
            th ID
            th Data da criação
            th Data de atualização
            th ID do colaborador
            th Nome do colaborador
            th ID da construção
            th Nome da construção
            th Status
        tbody
          each allocation in allocations
            tr
              td= allocation.id
              td= allocation.createdAt.toLocaleString('pt-BR', { timezone: 'UTC' })
              td= allocation.updatedAt ? allocation.updatedAt.toLocaleString('pt-BR', { timezone: 'UTC' }): ''
              td= allocation.userId
              td= allocation.user.name
              td= allocation.constructionId
              td= allocation.construction.name
              td= allocation.status === 'active' ? 'Ativa' : 'Concluída'
              td
                button.editBtn(onclick=`openModal(${JSON.stringify(allocation)})` data-id=allocation.id ) Editar
                button.deleteBtn(onclick=`openModalDelete(${allocation.id})` data-id=allocation.id) Excluir

    #editModal.modal
      .modal-content
        span.closeModal &times;
        h2 Obra
        form(id="editUserForm")
          input(type="hidden", id="id", name="id")
          input(type="hidden", id="createdAt", name="createdAt")

          br
          label(for="usersSelect") Colaboradores:
          select.select(id="usersSelect")
            option(value=0)
            for user in users
              option(value=user.id)= user.name

          br
          label(for="constructionSelect") Construções:
          select.select(id="constructionSelect")
            option(value=0)
            for construction in constructions
              option(value=construction.id)= construction.name
              
          br
          label(for="status") Status:
          select.select(id="statusSelect")
            option(value=0)
            option(value='active') Ativa
            option(value='finished') Concluída

          br
          button(onclick='requestModal()') Salvar
          button(onclick='closeModal()') Cancelar
          label(id="errorMessage", style="display: none; color: red;")

    #deleteModal.modal
      .modal-content
        span.closeModal &times;
        h4 Confirmar Exclusão
        h4 Tem certeza de que deseja excluir essa companhia?
          input(type="text", id="idDelete", name="idDelete", readonly)

          br
          button.deleteBtn(onclick='deleteModalRequest()') Excluir
          button(onclick='closeModalDelete()') Cancelar
          label(id="errorMessageDelete", style="display: none; color: red;")

    script(src="./javascript/allocation.js")