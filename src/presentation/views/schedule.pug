extends ./layout/master
block head
  title Gerenciar agendamentos
  link(rel="stylesheet", href="./styles/schedule.css")
  script(src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js")
  script(src="https://unpkg.com/vanilla-masker@1.1.1/lib/vanilla-masker.js")

block content
  h1 Gerenciar agendamentos
  button(onclick='openModal()' class="addUser") Criar agendamentos
  main
    if schedules.length === 0
      p Não há agendamentos cadastrados.
    else
      table
        thead
          tr
            th ID
            th Data da criação
            th Data de atualização
            th ID do colaborador
            th Nome do colaborador
            th ID da construção
            th Nome da construção
            th ID da alocação
            th Data da alocação
            th Data do agendamento
            th Status
        tbody
          each schedule in schedules
            tr
              td= schedule.id
              td= schedule.createdAt.toLocaleString('pt-BR', { timezone: 'UTC' })
              td= schedule.updatedAt ? schedule.updatedAt.toLocaleString('pt-BR', { timezone: 'UTC' }): ''
              td= schedule.userId
              td= schedule.user.name
              td= schedule.constructionId
              td= schedule.construction.name
              td= schedule.allocationId
              td= schedule.allocation.createdAt
              td= schedule.status === 'active' ? 'Ativa' : 'Concluída'
              td
                button.editBtn(onclick=`openModal(${JSON.stringify(schedule)})` data-id=schedule.id ) Editar
                button.deleteBtn(onclick=`openModalDelete(${schedule.id})` data-id=schedule.id) Excluir

    #editModal.modal
      .modal-content
        span.closeModal &times;
        h2 Agendamento
        form(id="editUserForm")
          input(type="hidden", id="id", name="id")
          input(type="hidden", id="createdAt", name="createdAt")

          br
          label(for="usersSelect") Colaborador:
          select.select(id="usersSelect")
            option(value=0)
            for user in users
              option(value=user.id)= user.name

          br
          label(for="constructionSelect") Construções:
          select.select(id="constructionSelect")
            option(value=0)
            //- for construction in constructions
            //-   option(value=construction.id)= construction.name

          br
          label(for="allocationCreatedAt") Alocação:
          input(type="Date", id="allocationCreatedAt", name="allocationCreatedAt", readonly)

          input(type="hidden", id="allocationId", name="allocationId")
          
          br
          label(for="dateSchedule") Data do agendamento:
          input(type="Date", id="dateSchedule", name="dateSchedule", required)

          br
          label(for="status") Status:
          select.select(id="statusSelect")
            option(value=0)
            option(value='active') Ativa
            option(value='finished') Concluída

          br
          button(onclick='requestModal()') Salvar
          button(onclick='closeModal()') Cancelar
          label(id="errorMessage", style="display: none; color: red;")

    #deleteModal.modal
      .modal-content
        span.closeModal &times;
        h4 Confirmar Exclusão
        h4 Tem certeza de que deseja excluir esse agendamento?
          input(type="text", id="idDelete", name="idDelete", readonly)

          br
          button.deleteBtn(onclick='deleteModalRequest()') Excluir
          button(onclick='closeModalDelete()') Cancelar
          label(id="errorMessageDelete", style="display: none; color: red;")

    script(src="./javascript/schedule.js")